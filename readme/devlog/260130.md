# LG에서 요구한 것들
- 기존 연구에는 어떤 Challenge?
    - 1) abstraction을 안하면 어떤 문제가 있냐
    - 2) explore를 안하면 recall이 줄어드는 방향으로 rewrite가 진행되는 경우 있는지? (locality issue에 빠져서?)
    - explore를 잘 하게 만드는 방법? 1. Exploit, explore는 다른 Path를 가져올 것이다. 
    1) corpus tree 에서 retrieval path 조절할 수 있냐? 2) corpus tree에서 하위 개념들로 exploit할 수 있냐?

내가 보고 싶은 방향
- rewrite하면 에러 있을 때 어떻게 고칠까?
지금 보기 좋은 방향 / novelty를 줄 수 있는 방향
- abstract level thinking해야 한다 (abstract prompting + corpus tree로.)
    - corpus graph는 document에 대한 Multi-view를 제공해주는 것


# corpus tree - rewriter interaction을 위해서 보면 좋은 아이디어


# 2026-02-01 update
- Round3 rewrite context를 local/global 분리 대신 **flat retrieval 결과**로 구성하도록 변경.
    - leaf_descs: flat retrieval top-K **leaf**.
    - branch_descs: flat retrieval top-K **branch**.
- `--round3_anchor_local_rank v2`일 때 leaf_descs는 **anchor 순서를 유지하며 branch를 최고점 leaf로 치환**해서 구성.
    - branch 하위 leaf 전체를 모아 최고 점수 leaf 1개 선택 (경로 단계별 탐색 아님).
- 위 로직을 `src/run_round3_1.py` + `src/run_oracle_branch.py`에 반영.
- anchor 평가/메트릭을 **flat(anchor) 순서 기반**으로 통일하고, `ROUND3_ANCHOR_LOCAL_RANK=none`일 때는 **leaf-only로 top-K**를 구성.
- `ROUND3_ANCHOR_LOCAL_RANK` 확장:
    - v3: branch → **greedy 최고점 child**를 따라 leaf 선택.
    - v4: branch 하위 leaf를 **경로 평균 점수**로 비교해 최고 leaf 선택 (branch→leaf 구간 평균).
- 적용 범위: `src/run_round3_1.py`, `src/run_round3.py`, `src/run_round3_oracle.py`, `src/run_oracle_branch.py`, `src/hyperparams.py`.
